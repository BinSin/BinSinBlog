---
title: "D3"
date: 2018-07-24
thumbnailImagePosition: left
thumbnailImage: http://d2sobhai8a0tcj.cloudfront.net/thumbnail/d3.jpg
coverImage: http://d2sobhai8a0tcj.cloudfront.net/thumbnail/D3cover.png
metaAlignment: center
coverMeta: out
categories:
- JavaScript
- D3
tags:
- JavaScript
- D3
- Data-Driven Documents
---

# Data-Driven Documents
[D3.js](https://ko.wikipedia.org/wiki/D3.js)(D3 또는 Data-Driven Documents)는 웹브라우저 상에서 동적이고 인터렉티브한 정보시각화를 구현하기 위한 자바스크립트 라이브러리이다.
<!--more-->

<br />
<br />
## D3 Start
- [D3홈페이지](https://d3js.org/) 에서 라이브러리를 다운
- 직접 스크립트 요소에 src 속성을 추가

```html
<html>
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
  </head>
</html>
```

<br />
<br />
## Basic D3 Visualization Pattern
- select() or selectAll()
- data()
- enter()
- append()

### D3 Selections
D3 Selections 는 자바스크립트의 배열이다.

- d3.select() : 첫번째로 매칭되는 요소만 선택
- d3.selectAll() : 매칭되는 모든 요소 선택

이들은 2차 배열 형태로 리턴되는데 select 는 처음에 만난 요소만 리턴해주고 selectAll 은 모든 요소를 리턴해준다.

```html
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <p>Hello World</p>
    <ul>
      <li>One</li>
      <li>Two</li>
      <li>Three</li>
    </ul>
    <p class="fancy-paragraph">Evening Gown Required</p>
    <p class="fancy-paragraph" style="color:red;">Tuxedo Required</p>
    <span style="color:red;">Bridge</span>
    <span id="wide-span">Brooklyn Brigde</span>
    <div class="outer-div">
      outer
      <div class="inner-div")>
        inner
      </div>
    </div>
  </body>
</html>
```
위의 코드를 예제로 두겠다.

```JavaScript
d3.select("p")[0]
d3.selectAll("'p")[0]
```
를 해주면 </br>
d3.select 는 [p] 만 리턴하고 </br>
d3.selectAll 은 [p, p.fancy-paragraph, p.fancy-paragraph] 모두를 리턴한다.

### D3 Arrays
데이터가 배열일 때의 D3의 정규 표현

- JavaScript Array Mutator Methods
```JavaScript
var array = [0 , 5, 10, 7, -2, 4];
array.reverse(); // 배열을 거꾸로
array.shift(); // 배열 섞기
array.sort(); // 배열 정렬
array.splice(1, 2); // 1~2까지만 선택하여 리턴해주고 버리기
array.splice(1, 1, "banana") // 1번째에서 1개를 버리고 "banana" 추가
array.unshift(5, 10, 7); // 5, 10, 7을 앞에 추가하고 길이 리턴
```

- JavaScript Array Accessor Methods
```JavaScript
var array = [0 , 5, 10, 7, -2, 4, 5];
var array2 = [1, 2];
array.concat(array2); // 뒤에 array2를 추가
array.join(); // 모든 요소를 string으로 리턴
array.slice(1, 4); // array의 1~3 까지의 요소를 리턴(array 변화 x)
array.slice(1); // 1부터 모든 요소를 리턴
array.indexOf(5) // 첫번째로 요소가 5인 인텍스 위치 리턴 -> 1
array.lastIndexOf(5); // 마지막으로 요소가 5인 인텍스 위치 리턴 ->
```

- Basic D3 Array Utilities
```JavaScript
var array = [0 , 5, 10, 7, -2, 4, 5];
d3.min(array); // 최소값 -> -2
d3.max(array); // 최대값 -> 10
d3.extent(array); // 최소값, 최대값 배열로 리턴
d3.sum(array); // 모든 요소의 합
d3.mean(array); // 평균값 -> d3.sum(array)/array.length
d3.median(array); // 중간값 -> 5
```

<br />
<br />
## Adding a DOM Element
DOM Element 추가하기

### D3 Append Operator
-  d3.select(name).append(name)
```JavaScript
d3.selectAll("li").append("hr"); // li 태그 모두에 hr 태그(한 줄)가 추가된다.
```

- d3.insert(name, (before))
```JavaScript
d3.select("body").insert("hr"); // body 태그의 마지막에 줄이 추가된다.
d3.select("body").insert("hr", "span"); // body 태그의 span 태그 위에 줄이 추가된다.
d3.select("body").insert("hr", ":first-child"); // 첫번째 자식은 p 태그 이므로 그 위에 줄이 추가된다.
d3.select(".outer-div").insert("hr", ".inner-div"); // inner 위에 줄이 추가된다.
d3.select("#narrow-span").insert("hr"); // #narrow_span 태그가 없으므로 추가되지 않는다. -> null
```

### D3 Remove Operator

- d3.remove()
```JavaScript
d3.select("body").remove(); // body 태그 제거
d3.select("li").remove(); // One 제거
d3.selectAll("li").remove(); // li 태그 전부 제거
```

<br />
<br />
## Fundamentals of SVG
SVG의 기초

### Scalable Vector Grraphics
[SVG](https://ko.wikipedia.org/wiki/%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%9F%AC%EB%B8%94_%EB%B2%A1%ED%84%B0_%EA%B7%B8%EB%9E%98%ED) 는2차원 벡터 그래픽을 표현하기 위한 XML 기반의 파일 형식으로, 1999년 W3C(World Wide Web Consortium)의 주도하에 개발된 오픈 표준의 벡터 그래픽 파일 형식이다. 벡터 그래픽은 픽셀 밖으로 생성되지 않아서 이미지 품질을 잃지 않고 크기를 늘리거나 줄일 수 있다.

### HTML5 Canvas
다용도의 JavaScript API 로 프로그래밍 방식의 그리기 작업을 코딩 할 수 있다. Canvas 는 그 자체로, 내부에 그려질 수 있는 Canvas context 객체를 정의할 수 있다.
```html
<canvas id="tutorial" width="150" height="150"></canvas>
```

### SVG vs HTML5 Canvas
SVG 는 각각의 그래픽 요소들이 DOM 객체를 만드는 Vector 기반 그래픽스이고 HTML5 는 자바스크립트 API 기반 이미지를 만드는 Raster 기반 그래픽스이다.

- 공통점
    - 그래픽 그리기를 허용
    - 2D로 그림을 그릴 수 있음
- 차이점
    - Canvas 는 복잡한 이미지를 허용한다.
    - Canvas 는 지속적인 성능을 제공한다.
    - Canvas 는 무언가 변경되면 모두 다시 그린다.
    - SVG 는 이벤트 첨부를 허용한다.
    - SVG 는 animation API 를 허용한다.
    - DOM 요소가 증가하면 SVG 의 속도가 느려진다.

### The Structure of SVG Within an HTML Document
svg 태그를 사용하며 사각형, 원, 타원, 선 등을 그릴 수 있다.

### The Syntax of Basic SVG Objects
A Rectangle
```html
<svg width="50" height="50">
  <rect x="0" y="0" width="50" height="50" />
</svg>
```
A Circle
```html
<svg width="50" height="50">
  <circle cx="25" cy="25" r="25" />
</svg>
```
An Ellipse
```html
<svg width="50" height="50">
 <ellipse cx="25" cy="25" rx="15" ry="10" />
</svg>
```
A Straight Line
```html
<svg width="50" height="50">
  <line x1="5" y1="5" x2="40" y2="40" stroke="gray" stroke-width="5"  />
</svg>
```
A Polyline
```html
<svg width="50" height="50">
  <polyline fill="none" stroke="blue" stroke-width="2"
    points="05,30
            15,30
            15,20
            25,20
            25,10
            35,10" />
</svg>
```
A Polygon
```html
<svg width="50" height="50">
  <polygon fill="yellow" stroke="blue" stroke-width="2"
    points="05,30
            15,10
            25,30" />
</svg>
```

<br />
<br />
## Adding an SVG Element
SVG Element 추가하기
```html
<svg width="50" height="50">
...
</svg>
```
여기서 svg 가 tag, width 와 height 가 attribute, 50 과 50 이 value 다.


### D3 Append Revisited
- d3.selection.append(name)

### Seeting Selection Attributes
- d3.selection.attr(name[, value]).attr(name[, value])

```JavaScript
d3.select(".svg_by_d3").append("svg").attr("width","50").attr("height","50").append("circle").attr("cx","25").attr("cy","25").attr("r","25").attr("fill","blue");
```
이렇게 모형을 추가할 수 있다.

### D3 Style Operator
- selection.style(name [, value [, priority]])
```JavaScript
d3.select(".svg_by_d3").append("svg").attr("width","50").attr("height","50")
    .append("circle").attr("cx","25").attr("cy","25").attr("r","25").style("fill","blue");
```
외부 스타일 시트와 일관되게 동작하기 때문에 style 연산자를 사용하는 것더 좋다.

### D3 Legibility through JS variables
```JavaScript
var divSelection = d3.select(".svg_by_d3");

var svgSelection = divSelection.append("svg")
    .attr("width","50")
    .attr("height","50");

var circleSelection = svgSelection.append("circle")
    .attr("cx","25")
    .attr("cy","25")
    .attr("r","25")
    .style("fill","blue");
```
가독성을 위해 이런 식으로 코딩을 하자!


<br />
<br />
## Basic D3 Visualization Pattern
- .select(...)
- .data(...)
- .enter()
- .append(...)
많은 차트에서 이 함수들을 필수이다.

### D3 Data Operator
- d3.selection.data([values[, key]])

```JavaScript
d3.select("body").insert("p");
d3.select("p").data([1]); // p의 데이터에  [1] 을 넣는다.
d3.select("p").data([[1, 2, 3]]); // [1, 2, 3] 을 넣는다.
d3.select("p").data([ function returnThree() { return 3; } ] ); // 함수도 넣을 수 있다.
d3.select("p").data([ superwoman = { "gender":"female", "transportation":"flying" }]); // 객체도 가능
d3.select("p")[0][0].__data__  // 여기서 data 를 확인할 수 있다.
```

### D3 Data Operator with many Data Values
selectAll 을 사용해서 여러 element 에 데이터 값을 넣을 수 있다.

```JavaScript
d3.select("body").insert("p");
d3.select("body").insert("p");
d3.selectAll("p").data([[1, 2, 3], [4, 5, 6]]);
```
첫번째 p 에는 [1, 2, 3] 이, 추번째 p 에는 [4, 5, 6] 이 들어간다.

만약
```JavaScript
d3.selectAll("p").data([ function() {return 3;}]);
```
이렇게 하면 첫번째 p 에만 data 가 들어간다.

그러므로
```JavaScript
d3.selectAll("p").data([
    superwoman = { "gender":"female", "transportation":"flying" },
    superman = { "gender":"male" , "transportation":"flying" } ]);
```
이런식으로 코딩하자~!


### D3 Update Selection

- d3.selection.data([values[, key]])
Update Selection 을 리턴한다.

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");
d3.select("body").insert("p").attr("class", "p_two");
d3.select("body").selectAll("p").data([1]);
```
첫번째 p 인 p.p_one 을 리턴한다

### D3 Exit Selection
- d3,selection,data(...).exit()

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");
d3.select("body").insert("p").attr("class", "p_two");

var updateSelection = d3.select("body").selectAll("p").data([1]);
updataSelectin.exit();
```
exit() 을 하면 두번째 p 인 p.p_two 를 리턴한다.


### D3 Enter Selection
- d3.selection.data(...).enter()

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");

var updateSelection = d3.select("body").select("p").data([1, 2]);
updateSelection.enter();
```
enter() 는 updateSelection 에서 DOM element가 발견되지 않으면 각 요소의 placeholder element 를 리턴한다.

```JavaScript
var updateSelection = d3.select("body").selectAll("p").data([1,2,3,4,5]);
```
이것은 5개의 DOM Object 가 리턴된다.


<br />
<br />
## JavaScript Functions
기본적으로는
```JavaScript
function functionName(var1, var2) {
  // some code
  return x;
}
functionName(args1, args2);
```

익명 함수 (anonymous function)
```JavaScript
var anonFunc = function(var1, var2) {
  // some code
  return x;
}
```

<br />
<br />
## Using Data Bound to DOM Elements

```JavaScript
var pData = d3.select("body").selectAll("p").data([1]).enter().append("p");
pData.data(); // [1]
var manyPData = d3.select("body").selectAll("p").data([9,0,2,1,0]).enter().append("p");
manyPData.data(); // [9,0,2,1,0]
```

### D3 Text Operator
- d3.selection.text([value])

```JavaScript
var pData = d3.select("body").selectAll("p").data([1]).enter().append("p");
pData.text("Hello"); // p 에 text 가 생긴다
var manyPData = d3.select("body").selectAll("p").data([9,0,2,1,0]).enter().append("p");
manyPData.text("Hello"); // Hello 가 5 개가 생긴다~!

manyPData.text(function() { return "Anonymous Function"; }); // 나중에 이런식으로 사용~
```

### Variables Available inside D3 Operators
- d : the __ data__ property
- i : the element index
- this : the DOM reference to the element in question

```JavaScript
var manyPData = d3.select("body").selectAll("p").data([1,2,3,4,5]).enter().append("p");
function myFunction(d, i) {
  return "argument d: " + d + " ... argument i: " + i;
};
manyPData.text(myFunction);
```
argument d: 1 ... argument i: 0 <br />
argument d: 2 ... argument i: 1 <br />
이런식으로 나온다

<br />
<br />
## Creating SVG Elements from Data

```JavaScript
var myData = [1,2,3,4,5];
var svgViewport = d3.select("body").append("svg").attr("width","400").attr("height","400");
var circleSelection = svgViewport.selectAll("circle").data(myData);
var circleElements = circleSelection.enter().append("circle");

circleElements.attr("cx",function(d,i) { return d * 25; })
    .attr("cy",function(d,i) { return d * 25; })
    .attr("r","25");

function greenRed(d,i) {
    if (i % 2 === 0) { return "green"; }
    else { return "red"; };
}

var circleStyle = circleElements.style("fill",greenRed);
// 초록, 빨강 순으로 색깔이 칠해진다.
```

<br />
<br />
## Using the SVG Coordinate Space
```html
     0
     ─ ─ ─ ─ ─ ─ ─ ─ > X
  0 │
    │
    │
    │
    │
    ∨
    Y
```
SVG 의 Space 는 이런 식으로 되어있다.

### D3 Append SVG Revisited
- d3.selection.append("svg");

```HTML
<svg width-"200" height="200">
  ...
</svg>
```

```JavaScript
d3.select("body").append("svg")
    .attr("width", "200")
    .attr("height", "200");
```
이 둘은 같다

### D3 & SVG Coordinate Space

```JavaScript
var svgSelection = d3.select("body").append("svg").attr("width","200").attr("height","200");
svgSelection.append("circle").attr("cx","0").attr("cy","0").attr("r","25").style("fill","black");
svgSelection.append("circle").attr("cx","75").attr("cy","75").attr("r","25").style("fill","yellow");
svgSelection.append("circle").attr("cx","150").attr("cy","150").attr("r","25").style("fill","green");
svgSelection.append("circle").attr("cx","225").attr("cy","225").attr("r","25").style("fill","blue"); // 이것은 나타나지 않는다.
```


<br />
<br />
## JavaScript Data Types
- 3 Primary Data Types : String, Number, Boolean
- 2 Composite Data Types : Object, Array
- 2 Special Data Types : null, undefined

### Primary Data Types
- String
- Number
- Boolean : true, false

### Composite Data Types
- Object

```JavaScript
var margin = { top: 20,
                        right: 20,
                        bottom: 30,
                        left: 50 };
```
(key) : (value)
- Array
Object 는 Array 가 아니므로 margin.length 가 없다

### Special Data Types
- null
- undefined


### JSON
- JavaScript Object Notation
- JavaScript 의 Object 와 JSON Object 와의 형태는 비슷하다.

```JSON
var margin = { "top": 20,
                        "right": 20,
                        "bottom": 30,
                        "left": 50 };
```


<br />
<br />
## D3 and JSON
- d3.keys(object)

```JavaScript
var margin = {"top":20, "right":20, "bottom":30, "left":50};
d3.keys(margin); // {"top", "right", "bttom", "left"}
```

- d3.values(object)

```JavaScript
var margin = {"top":20, "right":20, "bottom":30, "left":"50"};
d3.values(margin); // [20, 20, 30, "50"]
```

- d3.entries(object)

```JavaScript
var margin = {"top":20, "right":20, "bottom":30, "left":50};
d3.entries(margin); // [Object, Object, Object, Object]
```

### JSON in the D3 Data Operator

```JavaScript
betterMargins = [ { "direction":"top",    "units":"20" },
                  { "direction":"right",  "units":"20" },
                  { "direction":"bottom", "units":"30" },
                  { "direction":"left",   "units":"50" } ];

var paragraphs = d3.select("body").selectAll("p").data(betterMargins).enter().append("p");

paragraphs.text( function (d,i) { return d.direction + ": " + d.units; });
// top: 20, right: 20 이런 식으로 생긴다
```


<br />
<br />
## D3 and SVG Basic Shapes
- Rectangle
- Circle
- Ellipse
- Straight Line
- Polyline, Polygon and Path

```JavaScript
// Rectangle
var svgContainer = d3.select("body").append("svg").attr("width","200").attr("height","200");

var rectangles = [ {"x": 0,   "y":   0, "width": 30, "height": 40},
                   {"x": 50,  "y":  50, "width": 30, "height": 40},
                   {"x": 100, "y": 100, "width": 30, "height": 40},
                   {"x": 150, "y": 150, "width": 30, "height": 40} ];

var svgRectangles = svgContainer.selectAll("rect").data(rectangles).enter().append("rect");
// JSON 객체들이 SVG rectangle DOM element 로 바인드 된다.

svgRectangles
    .attr("x",      function (d,i) { return d.x;  })
    .attr("y",      function (d,i) { return d.y;      })
    .attr("width",  function (d,i) { return d.width;  })
    .attr("height", function (d,i) { return d.height; });
// 바인드 된 객체들을 그려준다.
```

### D3 and SVG Paths
- d3.svg.line()

```JavaScript
myData = [ { "x":05, "y":30   },{ "x": 75, "y":30  },
           { "x":75, "y":90   },{ "x":150, "y":90  },
           { "x":150, "y":150 },{ "x":190, "y":150 }];
```
line 함수를 이용하여 데이터를 알맞게 변형시킨다.

```JavaScript
var lineFunction = d3.svg.line()
   .x(function(d) { return d.x; })
   .y(function(d) { return d.y; })
   .interpolate("linear");

lineFunction(myData);
```
"M5,30L75,30L75,90L150,90L150,150L190,150" 라고 나오는데 이것을<br />
"M5,30 L75,30 L75,90 L150,90 L150,150 L190,150" 로 바꾼 뒤

```JavaScript
var svgContainer = d3.select("body").append("svg").attr("width","200").attr("height","200");

svgContainer.append("path")
      .attr("d","M5,30 L75,30 L75,90 L150,90 L150,150 L190,150")
      .attr("stroke", "blue")
      .attr("stroke-width", 2)
      .attr("fill", "none");
// path 가 그려진다.
```
이렇게 할 수 있지만

```JavaScript
svgContainer.append("path").datum(myData)
      .attr("d",lineFunction)
      .attr("stroke", "blue")
      .attr("stroke-width", 2)
      .attr("fill", "none");
```
이렇게 하는 것이 좋다.

<br />
<br />
## Dynamic SVG Coordinate Space
동적 SVG 공간 꾸미기

### Basic D3 Array Utilities
- d3.min
- d3.max
- d3.extent
- d3.sum
- d3.mean
- d3.median

```JavaScript
var myData = [ { "x":05, "y":30   },{ "x": 75, "y":30  },
               { "x":75, "y":90   },{ "x":150, "y":90  },
               { "x":150, "y":150 },{ "x":190, "y":150 }];

d3.min(myData, function(d) { return d.x; }); // myData 에서 가장 작은 x의 값을 리턴 -> 5
d3.max(myData, function(d) {return d.y }); // 가장 큰 y의 값 리턴 -> 150
d3.extent(myata, function(d) { return d.x; }); // x의 범위 리턴 -> [5, 190]

// x 와 y 범위 안의 svg 공간을 만들기
var maxX = d3.max(myData, function(d) { return d.x; }); // 190
var maxY = d3.max(myData, function(d) { return d.y; }); // 150
var svgViewport = d3.select("body").append("svg").attr("width", maxX).attr("height", maxY);

// myData 를 바탕으로 원 생성
var circles = svgViewport.selectAll("circle").data(myData).enter().append("circle");
var circleAttributes = circles.attr("cx", function(d,i) { return d.x;})
    .attr("cy", function(d,i) { return d.y;})
    .attr("r",  "10");
```


<br />
<br />
## D3 Scales
- Quantitative Scales : 숫자와 같은 연속적인 입력 도메인
- Ordinal Scales : 이름이나 카테고리와 같은 개별 입력 도메인
- Time Scales : 시간 도메인

### Quantitative Scales
- Linear Scales
- Power Scales
- Log Scales
- Quantize Scales
- Quantile Scales
- Threshold Scales
.
### Ordinal Scales
- Ordinal Scales
- Categorical Colors
- ColorBrewer

### Time Scales
- Time Scales

### Linear Scales
- y = mx + b

```JavaScript
// Linear Scale

myData = [ { "n":  0, "p":  0 },{ "n":200, "p":200 },
           { "n":300, "p":300 },{ "n":400, "p":400 }];

d3.scale.linear()
        // input
        .domain([0,400])  // y = mx + b
        // output
        .range([0,200]);    // y = 1/2 * mx + b -> 데이터를 1/2 으로 바꾼다.
```
domain() 은 범위를 가리킨다. <br />

- abs(m) < 1 : 데이터가 축소된다
- abs(m) > 1 : 데이터가 확장된다
- b > 0 ::데이터를 오른쪽으로 이동시킨다.
- b < 0 : 데이터를 왼쪽으로 이동시킨다.

### D3 Scales Function

```JavaScript
var scaleUp = d3.scale.linear().domain([0,10]).range([0, 100]);
// m = 10
[scaleUp(1), scaleUp(2), scaleUp(5), scaleUp(8), scaleUp(9)];
// [10, 20, 50, 80, 90]

var scaleDown = d3.scale.linear().domain([0,100]).range([0,10]);
// m = 1/10
[scaleDown(10), scaleDown(20), scaleDown(50), scaleDown(80), scaleDown(90)];
// [1, 2, 5, 8, 9]

var shiftRight = d3.scale.linear().domain([0,100]).range([100,200]);
// d = 100
[shiftRight(10), shiftRight(20), shiftRight(50), shiftRight(80), shiftRight(90)];
// [110, 120, 150, 180, 190

var shiftLeft = d3.scale.linear().domain([100,200]).range([0,100]);
// d = -100
[shiftLeft(110), shiftLeft(120), shiftLeft(150), shiftLeft(180), shiftLeft(190)];
// [10, 20, 50, 80, 90]

 var scaleUpAndShiftRight = d3.scale.linear().domain([0,10]).range([100,200]);
 // m = 10, d = 100
 [scaleUpAndShiftRight(1), scaleUpAndShiftRight(2), scaleUpAndShiftRight(5), scaleUpAndShiftRight(8), scaleUpAndShiftRight(9)];
 // [110, 120, 150, 180, 190]

 var scaleReverse = d3.scale.linear().domain([0,10]).range([10,0]);
 [scaleReverse(1), scaleReverse(2), scaleReverse(5), scaleReverse(8), scaleReverse(9)];
 // [9, 8, 5, 2, 1]
```

### SVG Container and D3 Scales

```HTML
<svg width="200" height="200">
```

```JavaScript
myData = [ { "n":  0, "p":  0 },{ "n":200, "p":200 },
           { "n":300, "p":300 },{ "n":400, "p":400 }];

minN = d3.min(myData, function(d) { return d.n })
minP = d3.min(myData, function(d) { return d.p });
maxN = d3.max(myData, function(d) { return d.n });
maxN = d3.max(myData, function(d) { return d.p });

domainN = d3.extent(myData, function(d) { return d.n }); // [0, 400]
domainP = d3.extent(myData, function(d) { return d.p }); // [0, 400]

rangeSVGX = [0,200];
rangeSVGY = [0,200];

var xLineScale = d3.scale.linear().domain(domainN).range(rangeSVGX);
// xLineScale(0) = 0, xLineScale(400) = 200
var yLineScale = d3.scale.linear().domain(domainP).range(rangeSVGY);
// yLineScale(0) = 0, yLineScale(400) = 200
```

### D3 Scales and SVG Data Points

```JavaScript
// myData 의 배열 수 만큼 circle 요소가 생성
var circleSelection = svgContainer.selectAll("circle").data(myData).enter().append("circle");

// circle 요소에 데이터 추가
var circleSelection = svgContainer.selectAll("circle").data(myData).enter().append("circle");

// range 에 맞게 원이 생성
var circleAttributes = circleSelection
    .attr("cx",function(d,i){ return xLineScale(d.n) })
    .attr("cy",function(d,i){ return yLineScale(d.p) })
    .attr("r","15");
```
각 요소의 data 는 변하지 않는다.

### D3 Ordinal Scales
이름이나 캍테고리와 같은 도메인의 경우 사용 <br />

- d3.scale.ordinal()

- 변수
```JavaScript
var alphabet = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];

var numbersUP = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26];
var numbersDN = [26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1];
```

- range(numbersUP)

```JavaScript
var ordinalScale = d3.scale.ordinal();
ordinalScale.domain(alphabet);
ordinalScale.range(numbersUP);
ordinalScale("A") // 1
ordinalScale("Z") // 26
```

- range(numbersDN)

```JavaScript
var ordinalScale = d3.scale.ordinal();
ordinalScale.domain(alphabet);
ordinalScale.range(numbersDN);
ordinalScale("A") // 26
ordinalScale("Z") // 1
```

- scale.rangePoints();

```JavaScript
var ordinalScale = d3.scale.ordinal();
ordinalScale.domain(alphabet);
ordinalScale.rangePoints([1, 26])
ordinalScale("A") // 1
ordinalScale("Z") // 26
```

- scale.rangeBands

```JavaScript
var ordinalScale = d3.scale.ordinal();
ordinalScale.domain(alphabet);
ordinalScale.rangeBands([1,27]);
ordinalScale.rangeBand(); // 1
ordinalScale("A") // 1
ordinalScale("Z") // 26
```

- d3.scale.category()
```JavaScript
d3.scale.category10();
// 10 가지의 카테고리 색상 범위를 제공
d3.scale.category20();
// 20 가지의 카테고리 색상 범위를 제공
d3.scale.category20b();
// category20 과 다른 10 가지의 카테고리 색상 범위를 제공
d3.scale.category20c();
// category20, category20b 와 다른 10 가지의 카테고리 색상 범위를 제공
```

<br />
<br />
## SVG Group Element
- Grouping
- Transformation

```HTML
<svg width="200" height="200">
    <g fill="purple">
        <circle cx="20" cy="20" r="20" />
        <circle cx="70" cy="70" r="20" />
    </g>
    <g>
        <rect x="110" y="110" height="30" width="30" />
        <rect x="160" y="160" height="30" width="30" />
    </g>
</svg>
```

### SVG Group Element Transform

```HTML
<svg width="200" height="200">
    <g transform="translate(20,-20)">
        <circle cx="50" cy="50" r="20" />
    </g>
</svg>
```
x 좌표를 20 만큼 옮기고 y 좌표를 -20 만큼 옮긴다.

```HTML
<svg width="200" height="200">
    <circle id="outside" cx="40" cy="40" r="10" fill="green" />
    <g transform="translate(10,10)">
        <circle id="inside" cx="30" cy="30" r="10" fill="blue" />
    </g>
</svg>
```
blue 색의 원이 green 색의 원 위에 놓여져서 blue 색의 원만 나온다. <br />
안에 있는 태그일수록 위에 놓여진다~

### D3 and the SVG Group Element
- fill
- transform

```JavaScript
var groupSelection = svgSelection.append("g");

groupSelection.append("circle").attr("cx",20).attr("cy",20).attr("r",20);
groupSelection.append("circle").attr("cx",70).attr("cy",70).attr("r",20);

svgSelection.append("rect").attr("x",110).attr("y",110).attr("height",30).attr("width",30);
svgSelection.append("rect").attr("x",160).attr("y",160).attr("height",30).attr("width",30);

groupSelection.attr("fill","purple");
```
g 태그 안에 있는 원들만 보라색이 된다.

```JavaScript
groupSelection.attr("transform","translate(10, 20)");
```
 g 태그 안의 원들이 (10, 20) 만큼 이동된다.

 ```JavaScript
groupSelection.attr("transform","translate(" + 50 + "," + 50 + ")");

groupSelection.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
 ```
JavaScript 에서 string + number 는 string 이므로 이것이 가능하다.

<br />
<br />
## SVG Text Elements

```HTML
<svg>
    <circle cx="20" cy="20" r="20" fill="purple"/>
    <text x="50" y="50" font-family="sans-serif" font-size="12px" fill="red">Circle<text>
</svg>
```
HTML 로는 이렇게 text 태그를 사용

```JavaScript
var svgText = svgContainer.append("text");
svgText.attr("x",50).attr("y",50);
svgText.text("circle");
svgText.attr("font-family","sans-serif").attr("font-size",12);
```
JavaScript 로는 이렇게 text 를 사용

### D3 Data and SVG Text
```JavaScript
dataSet = [{"name":"Shanghai"        , "population":18, "rank": 1},
           {"name":"Guangzhou"       , "population":11, "rank":10},
           {"name":"Dongguan"        , "population": 8, "rank":20},
           {"name":"Cairo"           , "population": 7, "rank":30},
           {"name":"Saint Petersburg", "population": 5, "rank":40},
           {"name":"New Taipei"      , "population": 4, "rank":50}];

// 원 그리기
var svgContainer = d3.select("body").append("svg").attr("width","200").attr("height","200");

var circles = svgContainer.selectAll("circle").data(dataSet).enter().append("circle");

circles.attr("cx", function(d,i) { return (i+1)*25; })
          .attr("cy", function(d,i) { return (i+1)*25; })
          .attr("r" , function(d,i) { return d.population });

// text 나타내기
var circleLabels = svgContainer.selectAll("text").data(dataSet).enter().append("text");

circleLabels.attr("x", function(d, i) { return (i+1)*25; })
                   .attr("y", function(d, i) { return (i+1)*25; });
circleLabels.text(function(d, i) { return d.name; }); // name 이 출력
circleLabels.style("fill", "red"); // 글씨를 빨간색으로
circleLabels.text(function(d, i) { return "rank: " +  d.rank; }); // rank 가 출력
```

<br />
<br />
## Margin Convention
- 좌표 공간이 Viewport의 공간에서 벗어날 수 있으므로 여백을 둬야한다.

```JavaScript
var margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
```

<br />
<br />
## D3 and JS Dates and Times
- JavaScript 의 Composite Type 은 Object 와 Array

```JavaScript
var dateObject = new Date();

new daet();
new Date(value);
new Date(dateString);
new Date(year, month, day  
                [, hour, minute,
                second,
              millisecond]);

new Date(2018, 0); // 2018 - January
new DATE(2017, 11); 2017 - December
```

- d3.time.format(specifier)

```JavaScript
var dateFuture = new Date(2020, 0, 12);

dateFuture.getFullYear(); // 2020
dateFuture; // Sun Jan 12 2020 00:00:00 GMT-0500 (EST)

var dateFormatter1 = d3.time.format("%A");
dateFormatter1(DateFuture); // "Sunday"

var dateFormatter2 = d3.time.format("%B");
dateFormatter2(dateFuture); // "January"

var dateFormatter3 = d3.time.format("%m");
dateFormatter3(dateFuture); // month -> "01"

var dateFormatter4 = d3.time.format("%p");
dateFormatter4(dateFuture); // "AM"
```

### D3 Time Scales
- d3.time.scale()

```JavaScript
d3.time.scale()
        .domain([date_left, date_right])
        .range([number_left, number_right]))
```
D3 Time Scale 은 한 데이터 세트를 다른 데이터 세트로 확장할 수 있기 때문에 매우 유용하다.

```JavaScript
// Scale down
var timeScale1 = d3.time.scale()
    .domain([new Date(2020,0,1),new Date(2020,0,11)])
    .range([0,10]);
[timeScale1(new Date(2020,0,3)), timeScale1(new Date(2020,0,5)), timeScale1(new Date(2020,0,7))];
// [2, 4, 6]

// Scale up
var timeScale2 = d3.time.scale()
    .domain([new Date(2020, 0, 1), new Date(2020, 0, 11)])
    .range([0, 100]);
[timeScale2(new Date(2020,0,3)), timeScale2(new Date(2020,0,5)), timeScale2(new Date(2020,0,7))];
// [20, 40, 60]
```
날짜 및 시간이 포함된 Data Visualization 을 만들 때 유용하다.


<br />
<br />
## D3 Axes
- d3.svg.axis()

```JavaScript
d3.select("body").append("svg")
    .attr("width", 200)
    .attr("height",200)
  .append("g")
    .call( d3.svg.axis() );
```

scale 을 주지 않으면 0 과 1 사이로 된다.
```JavaScript
var myScale = d3.scale.linear()
    .domain( [0, 10] )
    .range ( [0,200] );

var myAxis = d3.svg.axis()
    .scale(myScale);

var mySVG = d3.select("body").append("svg")
    .attr("width", 200)
    .attr("height",200);

var axisGroup = mySVG.append("g").call( myAxis );
```
domain([0,10]) 이므로 0 에서 10 까지의 x 축이 그려진다.

```JavaScript
var margin = {top: 50, right: 50, bottom: 50, left: 50},
    width = 300 - margin.left - margin.right,           
    height = 300 - margin.top - margin.bottom;

var myScale = d3.scale.linear()
    .domain( [0,10] )
    .range ( [0,width] );

var myAxis = d3.svg.axis()
    .scale(myScale);

var mySVG = d3.select("body").append("svg")                 
    .attr("width", width + margin.left + margin.right)      
    .attr("height", height + margin.top + margin.bottom)    
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var axisGroup = mySVG.append("g").call( myAxis );
```
margin 을 줘서 x축을 그린다.

### D3 Axes Manipulation
- d3.svg.axis().orient([orientation])

```JavaScript
var margin = {top: 50, right: 50, bottom: 50, left: 50},
    width = 300 - margin.left - margin.right,           
    height = 300 - margin.top - margin.bottom;

var myScale = d3.scale.linear()
    .domain( [0, 10] )
    .range ( [0,width] );

var myAxis = d3.svg.axis().scale(myScale).orient("top");

var mySVG = d3.select("body").append("svg")                 
    .attr("width", width + margin.left + margin.right)      
    .attr("height", height + margin.top + margin.bottom)    
  .append("g")                                                               
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var axisGroup = mySVG.append("g").call( myAxis );
```
orientaion 을 top 으로 줬기 때문에 단위가 위에 나온다. <br />
만약 left로 주면 y축 모양으로 왼쪽에 단위가 나온다. <br />
따라서

```JavaScript
var myXAxis = d3.svg.axis().scale(myScale).orient("top");
var myYAxis = d3.svg.axis().scale(myScale).orient("left");
var axisXGroup = mySVG.append("g").call(myXAxis);
var axisYGroup = mySVG.append("g").call(myYAxis);
```
이렇게 하면 x, y 축 모양이 만들어진다.

### D3 Scales For Data
- (5, 5) 에 원 그리기

```JavaScript
var myDataPoint = [{"x":5, "y":5}];
var circle = mySVG.selectAll("circle")
                                .data(myDataPoint)
                                .enter()
                                .append("circle");

var circleAttributes = circle.attr("cx", function(d,i) { return myScale(d.x) }).attr("cy", function(d,i) { return myScale(d.y); }).attr("r", 5);
```
익명함수의 리턴값에 myScale 함수를 사용하면 주어진 스케일에 맞게 원이 표시된다. <br />

- 많은 데이터 넣기

```JavaScript
// 데이터
dataSet = [{"name":"Shanghai"        , "population":18, "rank": 1},
           {"name":"Guangzhou"       , "population":11, "rank":10},
           {"name":"Dongguan"        , "population": 8, "rank":20},
           {"name":"Cairo"           , "population": 7, "rank":30},
           {"name":"Saint Petersburg", "population": 5, "rank":40},
           {"name":"New Taipei"      , "population": 4, "rank":50}];

// svgViewport 추가
var svgViewport = d3.select("body").append("svg").attr("width",300).attr("height",300);

// 여백을 넣어 innerSpace 공간 추가
var margin = {top: 50, right: 50, bottom: 50, left: 50},
   width = 300 - margin.left - margin.right,           
   height = 300 - margin.top - margin.bottom;
var innerSpace = svgViewport.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// x, y 축 그리기
var yAxisScale = d3.scale.linear().domain([0,50]).range([0,width]);
var xAxisScale = d3.scale.linear().domain([0,20]).range([0,height]);

var myXAxis = d3.svg.axis().scale(xAxisScale).orient("top");
var myYAxis = d3.svg.axis().scale(yAxisScale).orient("left");

var axisXGroup = innerSpace.append("g").call( myXAxis );
var axisyGroup = innerSpace.append("g").call( myYAxis );

// 데이터에 맞는 원 그리기
var circles = innerSpace.append("g").selectAll("circle").data(dataSet).enter().append("circle");

var circleAttributes = circles
    .attr("cx", function(d,i) { return xAxisScale(d.population); })
    .attr("cy", function(d,i) { return yAxisScale(d.rank); })
    .attr("r",5);

// 데이터 text 표시
var text = innerSpace.append("g").selectAll("text").data(dataSet).enter().append("text");

tributes = text
    .attr("x", function(d,i) { return xAxisScale(d.population); })
    .attr("y", function(d,i) { return yAxisScale(d.rank); })
    .text(function(d,i) { return d.name; })
    .style("fill","red");
```

<br />
<br />
## Simple HTTP Server with Python
파이썬으로 Simple HTTP Server 만들기

### SimpleHTTPServer
- Python 2.X

```Python
python -m SimpleHTTPServer 8000
```

- Python 3.X

```Python
python3 -m http.server 8000 --bind 127.0.0.1
```
로 서버를 만들 수 있다.


<br />
<br />
## D3 Request
- d3.text()
- d3.json()
- d3.xml()
- d3.html()
- d3.tsv()
<br />
자바스크립트는 단일 스레드이기 때문에 프로그램 속도가 느려질 수 있다.  <br />
하지만 AJAX 를 사용하여 이 문제를 해결할 수 있다.

### [XMLHttpRequest (xhr)](https://en.wikipedia.org/wiki/XMLHttpRequest)
  - GET
  - POST
  - HEAD
  - PUT
  - DELETE
  - OPTIONS
<br />
XMLHttpRequest (XHR)는 웹 브라우저와 웹 서버간에 데이터를 전송하는 객체 형식의 API 이다.

### D3 XHR
- d3.text()

```JavaScript
d3.text(url [, mimeType] [, callback])
callback(error,data)
```

- d3.text()

```JavaScript
d3.json(url [, callback])
callback(error,data)
```

- d3.xml()

```JavaScript
d3.xml(url [, mimeType] [, callback])
callback(error,data)
```

- d3.html()

```JavaScript
d3.html(url [, callback])
callback(error,data)
```

- d3.csv() : 쉼표로 구분

```JavaScript
d3.csv(url [, callback])
callback(error,data)
```

CSV File

```
Year,Gender,City,Country
1997,Male,Boston,USA
2000,Female,Miami,USA
```

Parsed CSV

```
[
  { "Year":"1997","Gender":"Male",
    "City":"Boston","Country":"USA" },
    { "Year":"2000","Gender":"Female",
      "City":"Miami","Country":"USA" },
]
```

- d3.tsv() : Tab 으로 구분

```JavaScript
d3.tsv(url [, callback])
callback(error,data)
```

### Loading Data From Server

```JavaScript
var callbackError;
var callbackData;

d3.tsv("data.tsv",
  function(error, data) {
    callbackError = error;
    callbackData = data;
  }
);
```
이렇게 data 파일 형식에 따라 함수를 달리하여 데이터를 받을 수 있다.


<br />
<br />
## Basic Chart

### Line Chart
- [Line Chart](https://bl.ocks.org/mbostock/3883245)
https://avatars2.githubusercontent.com/u/230541?v=4&amp;s=60

```JavaScript
var callbackError;
var callbackData;

var margin = {top: 20, right: 20, bottom: 30, left: 50},
width = 960 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

// day는 d, month는 b, year은 y
var parseDate = d3.time.format("%d-%b-%y").parse;

var x = d3.time.scale()
    .range([0, width]);
// y축이 위로 상승
var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");
var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.close); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// csv 형식의 데이터를 처리
d3.tsv("data.tsv", function(error,data) {
    callbackError = error;
    callbackData  = data;
});

callbackData.forEach(function(d) {
    d.date = parseDate(d.date);
    d.close = +d.close;
});

x.domain(d3.extent(callbackData, function(d) { return d.date; }));
y.domain(d3.extent(callbackData, function(d) { return d.close; }));

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Price ($)");

svg.append("path")
    .datum(callbackData)
    .attr("class", "line")
    .attr("d", line)
    .attr("fill","none")
    .attr("stroke","steelblue")
    .attr("stroke-width","1.5px");
```

<br />
### Scatterplot
- [Scatterplot](https://bl.ocks.org/mbostock/3887118)

```JavaScript
var callbackError;
var callbackData;

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width]);
var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");
var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.tsv("data.tsv", function(error,data) {
    callbackError = error;
    callbackData  = data;
});

callbackData.forEach(function(d) {
    d.sepalLength = +d.sepalLength;
    d.sepalWidth = +d.sepalWidth;
});

// nice() 함수는 도메인의 범위를 가장 가까운 round value 값으로 변경시킨다.
//이를  Nicing 이라고 하는데  도메인이 불규칙한 데이터로 계산 될 때 유용하다.
x.domain(d3.extent(callbackData, function(d) { return d.sepalWidth; })).nice();
y.domain(d3.extent(callbackData, function(d) { return d.sepalLength; })).nice();

var color = d3.scale.category10();

// x축
svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis)
  .append("text")
    .attr("class", "label")
    .attr("x", width)
    .attr("y", -6)
    .style("text-anchor", "end")
    .text("Sepal Width (cm)");

// y축
svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
  .append("text")
    .attr("class", "label")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Sepal Length (cm)");

// 데이터 원으로 표시
svg.selectAll(".dot")
    .data(callbackData)
  .enter().append("circle")
    .attr("class", "dot")
    .attr("r", 3.5)
    .attr("cx", function(d) { return x(d.sepalWidth); })
    .attr("cy", function(d) { return y(d.sepalLength); })
    .style("fill", function(d) { return color(d.species); });

// 범주값 표시
var legend = svg.selectAll(".legend")
    .data(color.domain()) // "3가지의 종이 도메인으로 지정된다."
  .enter().append("g")
    .attr("class", "legend")
    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

legend.append("rect")
.attr("x", width - 18)
.attr("width", 18)
.attr("height", 18)
.style("fill", color);

legend.append("text")
    .attr("x", width - 24)
    .attr("y", 9)
    .attr("dy", ".35em")
    .style("text-anchor", "end")
    .text(function(d) { return d; });
```

<br />
### Bar Chart
- [Bar Chart](https://bl.ocks.org/mbostock/3885304)

```JavaScript
var callbackError;
var callbackData;

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var color = d3.scale.category10();

// 축의 구성 요소에 대한 포메터를 정의
var formatPercent = d3.format(".0%");
formatPercent(0.12); // 12%

// 0~width 까지를 .1 차이를 둬서
var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(formatPercent);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.tsv("data.tsv", function(error,data) {
    callbackError = error;
    callbackData  = data;
});

callbackData.forEach(function(d) {
    d.frequency = +d.frequency;
});

// 도메인을 알파벳으로 한다.
x.domain(callbackData.map(function(d) { return d.letter; }));
y.domain([0, d3.max(callbackData, function(d) { return d.frequency; })]);

svg.append("g")
    .attr("class", "x axis")
    .attr("transform","translate(0, " + height + ")")
    .call(xAxis);

// style("text-anchor", "end") 를 해야 끝에 맞게 글이 추가된다
svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Frequency");

// 커버를 rect 에 갖다 대면 color 에서 2단계 더 어두운 색으로 바뀐다.
svg.selectAll(".bar")
    .data(callbackData)
  .enter().append("rect")
    .attr("class", "bar")
    .attr("x", function(d) { return x(d.letter); })
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.frequency); })
    .attr("height", function(d) { return height - y(d.frequency); })
    .on("mouseover", function(d) {
          d3.select(this).style("fill", d3.rgb(color(d.rate)).darker(2));
      })
      .on("mouseout", function(d) {
          d3.select(this).style("fill", color(d.rate));
      });

// class="bar" 인 요소들을 steelblue 색으로 바꿈
svg.selectAll(".bar").attr("fill","steelblue");
```

<br />
### Bar chart With Negative Values

```JavaScript
var data = [-15, -20, -22, -18, 2, 6, -26, -18];

var margin = {top: 30, right: 10, bottom: 10, left: 10},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x0 = Math.max(-d3.min(data), d3.max(data));

var x = d3.scale.linear()
    .domain([-x0, x0])
    .range([0, width])
    .nice();

// rangeRoundBands : 높이가 80% 만 표시된다.
// rangeRoundBands([0,height], .7) : 30%만 표시
var y = d3.scale.ordinal()
    .domain(d3.range(data.length))
    .rangeRoundBands([0, height], .2);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("top");

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// d<0 이면 'bar negative' 로 d>=0 dlaus 'bar positive'로
svg.selectAll(".bar")
    .data(data)
  .enter().append("rect")
    .attr("class", function(d) { return d < 0 ? "bar negative" : "bar positive"; })
    .attr("x", function(d) { return x(Math.min(0, d)); })
    .attr("y", function(d, i) { return y(i); })
    .attr("width", function(d) { return Math.abs(x(d) - x(0)); })
    .attr("height", y.rangeBand());

d3.selectAll(".bar.negative").attr("fill","brown");
d3.selectAll(".bar.positive").attr("fill","steelblue");

svg.append("g")
    .attr("class", "x axis")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
  .append("line")
    .attr("x1", x(0))
    .attr("x2", x(0))
    .attr("y1", 0)
    .attr("y2", height)
    .style("fill","none")
    .style("stroke","#000")
    .style("shape-rendering", "crispEdges");
  ```

<br />
### Grouped Bar Chart
- [Grouped Bar Chart](https://bl.ocks.org/mbostock/3887051)

```JavaScript
var callbackError, callbackData;

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x0 = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);
var x1 = d3.scale.ordinal();
var y = d3.scale.linear()
    .range([height, 0]);

var color = d3.scale.ordinal()    
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var xAxis = d3.svg.axis()
    .scale(x0)
    .orient("bottom");
// d3.format(".2s")(1000000); -> 1.0M // 백만
var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(d3.format(".2s"));

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("data.csv", function(error,data) {
    callbackError = error;
    callbackData  = data;
    console.log([callbackError, callbackData.length]);
});

// State 를 제외한 키들을 배열에 넣는다.
var ageNames = d3.keys(callbackData[0]).filter(function(key) { return key !== "State"; });

callbackData.forEach(function(d) {
    d.ages = ageNames.map(function(name) { return {name: name, value: +d[name]}; });
});

// State 배열을 도메인으로 함 -> CA, TX, ...
x0.domain(callbackData.map(function(d) { return d.State; }));
// ageNames -> Under 5, ...
x1.domain(ageNames).rangeRoundBands([0, x0.rangeBand()]);
y.domain([0, d3.max(callbackData, function(d) { return d3.max(d.ages, function(d) { return d.value; }); })]);

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Population");

// State 의 범위만큼 transform 하는 g 태그 생성
var state = svg.selectAll(".state")
    .data(callbackData)
  .enter().append("g")
    .attr("class", "g")
    .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });

// d.ages = {d.name, d.value} 로 되어 있다.
// 이름에 따라 색을 다르게 채운다.
state.selectAll("rect")
    .data(function(d) { return d.ages; })
  .enter().append("rect")
    .attr("width", x1.rangeBand())
    .attr("x", function(d) { return x1(d.name); })
    .attr("y", function(d) { return y(d.value); })
    .attr("height", function(d) { return height - y(d.value); })
    .style("fill", function(d) { return color(d.name); });

// ageNames 를 slice() 함수를 이용하여 나눠서 g 태그 만듬
var legend = svg.selectAll(".legend")
    .data(ageNames.slice().reverse())
  .enter().append("g")
    .attr("class", "legend")
    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

legend.append("rect")
    .attr("x", width - 18)
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", color);

legend.append("text")
    .attr("x", width - 24)
    .attr("y", 9)
    .attr("dy", ".35em")
    .style("text-anchor", "end")
    .text(function(d) { return d; });
```

<br />
### Stacked Bar Chart
- [Stacked Bar Chart](https://bl.ocks.org/mbostock/3886208)
