---
title: "D3"
date: 2018-07-24
thumbnailImagePosition: left
thumbnailImage: http://d2sobhai8a0tcj.cloudfront.net/thumbnail/d3.jpg
coverImage: http://d2sobhai8a0tcj.cloudfront.net/thumbnail/D3cover.png
metaAlignment: center
coverMeta: out
categories:
- JavaScript
- D3
tags:
- JavaScript
- D3
- Data-Driven Documents
---

# Data-Driven Documents
[D3.js](https://ko.wikipedia.org/wiki/D3.js)(D3 또는 Data-Driven Documents)는 웹브라우저 상에서 동적이고 인터렉티브한 정보시각화를 구현하기 위한 자바스크립트 라이브러리이다.
<!--more-->

<br />
<br />
## D3 Start
- [D3홈페이지](https://d3js.org/) 에서 라이브러리를 다운
- 직접 스크립트 요소에 src 속성을 추가

```html
<html>
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
  </head>
</html>
```

<br />
<br />
## Basic D3 Visualization Pattern
- select() or selectAll()
- data()
- enter()
- append()

### D3 Selections
D3 Selections 는 자바스크립트의 배열이다.

- d3.select() : 첫번째로 매칭되는 요소만 선택
- d3.selectAll() : 매칭되는 모든 요소 선택

이들은 2차 배열 형태로 리턴되는데 select 는 처음에 만난 요소만 리턴해주고 selectAll 은 모든 요소를 리턴해준다.

```html
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <p>Hello World</p>
    <ul>
      <li>One</li>
      <li>Two</li>
      <li>Three</li>
    </ul>
    <p class="fancy-paragraph">Evening Gown Required</p>
    <p class="fancy-paragraph" style="color:red;">Tuxedo Required</p>
    <span style="color:red;">Bridge</span>
    <span id="wide-span">Brooklyn Brigde</span>
    <div class="outer-div">
      outer
      <div class="inner-div")>
        inner
      </div>
    </div>
  </body>
</html>
```
위의 코드를 예제로 두겠다.

```JavaScript
d3.select("p")[0]
d3.selectAll("'p")[0]
```
를 해주면 </br>
d3.select 는 [p] 만 리턴하고 </br>
d3.selectAll 은 [p, p.fancy-paragraph, p.fancy-paragraph] 모두를 리턴한다.

### D3 Arrays
데이터가 배열일 때의 D3의 정규 표현

- JavaScript Array Mutator Methods
```JavaScript
var array = [0 , 5, 10, 7, -2, 4];
array.reverse(); // 배열을 거꾸로
array.shift(); // 배열 섞기
array.sort(); // 배열 정렬
array.splice(1, 2); // 1~2까지만 선택하여 리턴해주고 버리기
array.splice(1, 1, "banana") // 1번째에서 1개를 버리고 "banana" 추가
array.unshift(5, 10, 7); // 5, 10, 7을 앞에 추가하고 길이 리턴
```

- JavaScript Array Accessor Methods
```JavaScript
var array = [0 , 5, 10, 7, -2, 4, 5];
var array2 = [1, 2];
array.concat(array2); // 뒤에 array2를 추가
array.join(); // 모든 요소를 string으로 리턴
array.slice(1, 4); // array의 1~3 까지의 요소를 리턴(array 변화 x)
array.slice(1); // 1부터 모든 요소를 리턴
array.indexOf(5) // 첫번째로 요소가 5인 인텍스 위치 리턴 -> 1
array.lastIndexOf(5); // 마지막으로 요소가 5인 인텍스 위치 리턴 ->
```

- Basic D3 Array Utilities
```JavaScript
var array = [0 , 5, 10, 7, -2, 4, 5];
d3.min(array); // 최소값 -> -2
d3.max(array); // 최대값 -> 10
d3.extent(array); // 최소값, 최대값 배열로 리턴
d3.sum(array); // 모든 요소의 합
d3.mean(array); // 평균값 -> d3.sum(array)/array.length
d3.median(array); // 중간값 -> 5
```

<br />
<br />
## Adding a DOM Element
DOM Element 추가하기

### D3 Append Operator
-  d3.select(name).append(name)
```JavaScript
d3.selectAll("li").append("hr"); // li 태그 모두에 hr 태그(한 줄)가 추가된다.
```

- d3.insert(name, (before))
```JavaScript
d3.select("body").insert("hr"); // body 태그의 마지막에 줄이 추가된다.
d3.select("body").insert("hr", "span"); // body 태그의 span 태그 위에 줄이 추가된다.
d3.select("body").insert("hr", ":first-child"); // 첫번째 자식은 p 태그 이므로 그 위에 줄이 추가된다.
d3.select(".outer-div").insert("hr", ".inner-div"); // inner 위에 줄이 추가된다.
d3.select("#narrow-span").insert("hr"); // #narrow_span 태그가 없으므로 추가되지 않는다. -> null
```

### D3 Remove Operator

- d3.remove()
```JavaScript
d3.select("body").remove(); // body 태그 제거
d3.select("li").remove(); // One 제거
d3.selectAll("li").remove(); // li 태그 전부 제거
```

<br />
<br />
## Fundamentals of SVG
SVG의 기초

### Scalable Vector Grraphics
[SVG](https://ko.wikipedia.org/wiki/%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%9F%AC%EB%B8%94_%EB%B2%A1%ED%84%B0_%EA%B7%B8%EB%9E%98%ED) 는2차원 벡터 그래픽을 표현하기 위한 XML 기반의 파일 형식으로, 1999년 W3C(World Wide Web Consortium)의 주도하에 개발된 오픈 표준의 벡터 그래픽 파일 형식이다. 벡터 그래픽은 픽셀 밖으로 생성되지 않아서 이미지 품질을 잃지 않고 크기를 늘리거나 줄일 수 있다.

### HTML5 Canvas
다용도의 JavaScript API 로 프로그래밍 방식의 그리기 작업을 코딩 할 수 있다. Canvas 는 그 자체로, 내부에 그려질 수 있는 Canvas context 객체를 정의할 수 있다.
```html
<canvas id="tutorial" width="150" height="150"></canvas>
```

### SVG vs HTML5 Canvas
SVG 는 각각의 그래픽 요소들이 DOM 객체를 만드는 Vector 기반 그래픽스이고 HTML5 는 자바스크립트 API 기반 이미지를 만드는 Raster 기반 그래픽스이다.

- 공통점
    - 그래픽 그리기를 허용
    - 2D로 그림을 그릴 수 있음
- 차이점
    - Canvas 는 복잡한 이미지를 허용한다.
    - Canvas 는 지속적인 성능을 제공한다.
    - Canvas 는 무언가 변경되면 모두 다시 그린다.
    - SVG 는 이벤트 첨부를 허용한다.
    - SVG 는 animation API 를 허용한다.
    - DOM 요소가 증가하면 SVG 의 속도가 느려진다.

### The Structure of SVG Within an HTML Document
svg 태그를 사용하며 사각형, 원, 타원, 선 등을 그릴 수 있다.

### The Syntax of Basic SVG Objects
A Rectangle
```html
<svg width="50" height="50">
  <rect x="0" y="0" width="50" height="50" />
</svg>
```
A Circle
```html
<svg width="50" height="50">
  <circle cx="25" cy="25" r="25" />
</svg>
```
An Ellipse
```html
<svg width="50" height="50">
 <ellipse cx="25" cy="25" rx="15" ry="10" />
</svg>
```
A Straight Line
```html
<svg width="50" height="50">
  <line x1="5" y1="5" x2="40" y2="40" stroke="gray" stroke-width="5"  />
</svg>
```
A Polyline
```html
<svg width="50" height="50">
  <polyline fill="none" stroke="blue" stroke-width="2"
    points="05,30
            15,30
            15,20
            25,20
            25,10
            35,10" />
</svg>
```
A Polygon
```html
<svg width="50" height="50">
  <polygon fill="yellow" stroke="blue" stroke-width="2"
    points="05,30
            15,10
            25,30" />
</svg>
```

<br />
<br />
## Adding an SVG Element
SVG Element 추가하기
```html
<svg width="50" height="50">
...
</svg>
```
여기서 svg 가 tag, width 와 height 가 attribute, 50 과 50 이 value 다.


### D3 Append Revisited
- d3.selection.append(name)

### Seeting Selection Attributes
- d3.selection.attr(name[, value]).attr(name[, value])

```JavaScript
d3.select(".svg_by_d3").append("svg").attr("width","50").attr("height","50").append("circle").attr("cx","25").attr("cy","25").attr("r","25").attr("fill","blue");
```
이렇게 모형을 추가할 수 있다.

### D3 Style Operator
- selection.style(name [, value [, priority]])
```JavaScript
d3.select(".svg_by_d3").append("svg").attr("width","50").attr("height","50")
    .append("circle").attr("cx","25").attr("cy","25").attr("r","25").style("fill","blue");
```
외부 스타일 시트와 일관되게 동작하기 때문에 style 연산자를 사용하는 것더 좋다.

### D3 Legibility through JS variables
```JavaScript
var divSelection = d3.select(".svg_by_d3");

var svgSelection = divSelection.append("svg")
    .attr("width","50")
    .attr("height","50");

var circleSelection = svgSelection.append("circle")
    .attr("cx","25")
    .attr("cy","25")
    .attr("r","25")
    .style("fill","blue");
```
가독성을 위해 이런 식으로 코딩을 하자!


<br />
<br />
## Basic D3 Visualization Pattern
- .select(...)
- .data(...)
- .enter()
- .append(...)
많은 차트에서 이 함수들을 필수이다.

### D3 Data Operator
- d3.selection.data([values[, key]])

```JavaScript
d3.select("body").insert("p");
d3.select("p").data([1]); // p의 데이터에  [1] 을 넣는다.
d3.select("p").data([[1, 2, 3]]); // [1, 2, 3] 을 넣는다.
d3.select("p").data([ function returnThree() { return 3; } ] ); // 함수도 넣을 수 있다.
d3.select("p").data([ superwoman = { "gender":"female", "transportation":"flying" }]); // 객체도 가능
d3.select("p")[0][0].__data__  // 여기서 data 를 확인할 수 있다.
```

### D3 Data Operator with many Data Values
selectAll 을 사용해서 여러 element 에 데이터 값을 넣을 수 있다.

```JavaScript
d3.select("body").insert("p");
d3.select("body").insert("p");
d3.selectAll("p").data([[1, 2, 3], [4, 5, 6]]);
```
첫번째 p 에는 [1, 2, 3] 이, 추번째 p 에는 [4, 5, 6] 이 들어간다.

만약
```JavaScript
d3.selectAll("p").data([ function() {return 3;}]);
```
이렇게 하면 첫번째 p 에만 data 가 들어간다.

그러므로
```JavaScript
d3.selectAll("p").data([
    superwoman = { "gender":"female", "transportation":"flying" },
    superman = { "gender":"male" , "transportation":"flying" } ]);
```
이런식으로 코딩하자~!


### D3 Update Selection

- d3.selection.data([values[, key]])
Update Selection 을 리턴한다.

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");
d3.select("body").insert("p").attr("class", "p_two");
d3.select("body").selectAll("p").data([1]);
```
첫번째 p 인 p.p_one 을 리턴한다

### D3 Exit Selection
- d3,selection,data(...).exit()

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");
d3.select("body").insert("p").attr("class", "p_two");

var updateSelection = d3.select("body").selectAll("p").data([1]);
updataSelectin.exit();
```
exit() 을 하면 두번째 p 인 p.p_two 를 리턴한다.


### D3 Enter Selection
- d3.selection.data(...).enter()

```JavaScript
d3.select("body").insert("p").attr("class", "p_one");

var updateSelection = d3.select("body").select("p").data([1, 2]);
updateSelection.enter();
```
enter() 는 updateSelection 에서 DOM element가 발견되지 않으면 각 요소의 placeholder element 를 리턴한다.

```JavaScript
var updateSelection = d3.select("body").selectAll("p").data([1,2,3,4,5]);
```
이것은 5개의 DOM Object 가 리턴된다.


<br />
<br />
## JavaScript Functions
기본적으로는
```JavaScript
function functionName(var1, var2) {
  // some code
  return x;
}
functionName(args1, args2);
```

익명 함수 (anonymous function)
```JavaScript
var anonFunc = function(var1, var2) {
  // some code
  return x;
}
```

## Using Data Bound to DOM Elements

```JavaScript
var pData = d3.select("body").selectAll("p").data([1]).enter().append("p");
pData.data(); // [1]
var manyPData = d3.select("body").selectAll("p").data([9,0,2,1,0]).enter().append("p");
manyPData.data(); // [9,0,2,1,0]
```

### D3 Text Operator
- d3.selection.text([value])

```JavaScript
var pData = d3.select("body").selectAll("p").data([1]).enter().append("p");
pData.text("Hello"); // p 에 text 가 생긴다
var manyPData = d3.select("body").selectAll("p").data([9,0,2,1,0]).enter().append("p");
manyPData.text("Hello"); // Hello 가 5 개가 생긴다~!

manyPData.text(function() { return "Anonymous Function"; }); // 나중에 이런식으로 사용~
```

### Variables Available inside D3 Operators
- d
the __ data__ property

- i
the element index

- this
the DOM reference to the element in question
